{% extends "ticket/dashboard.html" %}
{% load staticfiles %}

{% load crispy_forms_tags %}
{#{% load material_form %}#}

{% block css %}
    <link rel="stylesheet" href="{% static 'plugins/datatables/jquery.dataTables.min.css' %}">
{% endblock %}
{% block content %}
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            利率
        </h1>
    </section>

    <section class="content">
		<div class="row">
				  <div class="col-lg-12 page-header bg-info">
		<h2 id='sumMoney' ></h2>
		<h2 id='result' ></h2>
		</div>
		</div><!-- /.row -->
		<div class="row">
		  <div class="col-lg-3">
			<div class="input-group">
		  <span class="input-group-addon">到期时间</span>
			  <input type="text" id="datep" class="form-control" aria-label="...">
			</div><!-- /input-group -->
		  </div><!-- /.col-lg-6 -->
		  <div class="col-lg-3">
			<div class="input-group">
		  <span class="input-group-addon">价格</span>
			  <input type="number" id="money" class="form-control" aria-label="...">
			</div><!-- /input-group -->
		  </div><!-- /.col-lg-6 -->
		  <div class="col-lg-1">
			<div class="input-group">
			<button type="button" id = "subm" class="btn btn-success">添加</button>
			</div><!-- /input-group -->
		  </div>

		  <div class="btn-group col-lg-3" data-toggle="buttons">
			  <label class="btn btn-default active">
				<input type="radio" name="options" id="piaozhi" autocomplete="off" checked>纸票
			  </label>
			  <label class="btn btn-default">
				<input type="radio" name="options" id="piaodian" autocomplete="off">电票
			  </label>
			</div>

		</div><!-- /.row -->
		<div class="row">
				  <div class="col-lg-6">

		<table class="table table-striped table-bordered">
		  <thead>
			<tr>
			  <th>类型</th>
			  <th>到期时间</th>
			  <th>价格</th>
			  <th>天数</th>
			  <th>月利率</th>
			  <th>年利率</th>
			  <th></th>
			</tr>
		  </thead>
		  <tbody id="thebody">

		  </tbody>
		 <!-- <tfoot id="thefoot">-->
			<!--<tr>-->

			<!--  <th id="avgMoney" td colspan="2"></th>-->
			<!--  <th id="avgDays"  td colspan="2"></th>-->
			<!--</tr>-->
		 <!-- </tfoot>-->
		</table>
		</div>
		</div><!-- /.row -->

    </section>

{% endblock %}


{% block script %}
    <!-- page script -->
    <script src="{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'plugins/datatables/dataTables.bootstrap.js' %}"></script>
    <script src="{% static 'plugins/datepicker/bootstrap-datepicker.js' %}"></script>

	<script>

		$.fn.datepicker.dates['cn'] = {   //切换为中文显示
			days: ["周日", "周一", "周二", "周三", "周四", "周五", "周六", "周日"],
					daysShort: ["日", "一", "二", "三", "四", "五", "六", "七"],
					daysMin: ["日", "一", "二", "三", "四", "五", "六", "七"],
					months: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
					monthsShort: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
					today: "今天",
					clear: "清除"
			};
		$('#datep').datepicker({
			autoclose: true, //自动关闭
			clearBtn: true,          //显示清除按钮
			format: 'yyyy/mm/dd',
			startDate: '0d',
			language: 'cn',           //语言
		});
		function delItem(that) {
			console.log('delItem');
			console.log($(that).html());
			$(that).parent().parent().remove();
		}
		function addItem() {
			console.log('addItem');
			console.log($('#datep').val());
			 　　var now = new Date();
			 now.setHours(0);
			 now.setMinutes(0);
			 now.setSeconds(0);
			 now.setMilliseconds(0);
			  　　var sdate = new Date($('#datep').val());
			var days = Math.abs(sdate - now);
			//var days = sdate.getTime() - now.getTime();
		　　var day = Math.floor(days / (1000 * 60 * 60 * 24));
			console.log(days+'---'+day);
			var week = sdate.getDay();
			if(week == 0){
				day = day + 1;
				}else if(week == 6){
				day = day + 2;
				}
			console.log($("#piaozhi").is(":checked")+'---'+$("#piaodian").is(":checked"));
			var piaotype = "电票";
			if($("#piaozhi").is(":checked")){
				day = day + 3;
				piaotype = "纸票";
			}

			console.log(days+'---'+day);
			console.log($('#money').val()+'---');
			var themonth = Number($('#money').val())*0.3/day;
			console.log(themonth+'---');
			var theyear = themonth * 1.2;
			var trr = "<tr data-d='"+day+"' data-m='"+$('#money').val()+"'>"
						+"<td>"+piaotype+"</td>"
			+"<td>"+$('#datep').val()+"</td><td>"+$('#money').val()+"</td><td>"+day+'</td>'
			+"<td>"+themonth.toFixed(2)+"</td>"
			+"<td>"+theyear.toFixed(2)+"</td>"
			+'<td><button type="button" onclick="delItem(this)" class="btn btn-danger">删除</button></td>'+"</tr>";

			$('#thebody').append(trr);

		}
        $('#subm').click(function () {
                addItem();
            });
        $('#sum').click(function () {
                sumItems();
            });
	</script>

{% endblock %}
