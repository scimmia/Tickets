{% extends "ticket/dashboard.html" %}
{% load staticfiles %}

{% load crispy_forms_tags %}
{% load static %}

{#{% load material_form %}#}
{% block css %}
    <script src="{% static 'plugins/echarts/echarts.common.min.js' %}"></script>



{% endblock %}
{% block content %}
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            资金池
            <small>概览</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i> 主页</a></li>
            <li class="active">资金池</li>
        </ol>
    </section>

    <section class="content">
        <div class="row">
            <!-- left column -->
            <div class="col-md-5">
                <div class="small-box bg-aqua">
                    <div class="inner">
                        <p>总额度</p>
                        <h3>{{ item.totalmoney }}</h3>

                    </div>
                    <div class="icon">
                        <i class="fa ion-pie-graph"></i>
                    </div>
                    <a href="#" class="small-box-footer">
                        More info <i class="fa fa-arrow-circle-right"></i>
                    </a>
                </div>
                <div class="row">
                    <div class="col-lg-6 col-xs-6">
                        <!-- small box -->
                        <div class="small-box bg-maroon">
                            <div class="inner">
                                <p>入池票:{{ count_t }}张</p>
                                <h3>{{ sum_money }}</h3>
                            </div>
                            <div class="icon">
                                <i class="ion ion-clipboard"></i>
                            </div>
                            <a href="#" class="small-box-footer">
                                More info <i class="fa fa-arrow-circle-right"></i>
                            </a>
                        </div>
                    </div>
                    <!-- ./col -->
                    <div class="col-lg-6 col-xs-6">
                        <!-- small box -->
                        <div class="small-box bg-yellow">
                            <div class="inner">
                                <p>保证金</p>
                                <h3>{{ item.promoney }}</h3>
                            </div>
                            <div class="icon">
                                <i class="ion ion-card"></i>
                            </div>
                            <a href="#" class="small-box-footer">
                                More info <i class="fa fa-arrow-circle-right"></i>
                            </a>
                        </div>
                    </div>
                    <!-- ./col -->
                </div>
                <div class="row">
                    <div class="col-lg-6 col-xs-6">
                        <!-- small box -->
                        <div class="small-box bg-green">
                            <div class="inner">
                                <p>可用额度</p>
                                <h3>{{ item.unusemoney }}</h3>
                            </div>
                            <div class="icon">
                                <i class="ion ion-ios-unlocked"></i>
                            </div>
                            <a href="#" class="small-box-footer">
                                More info <i class="fa fa-arrow-circle-right"></i>
                            </a>
                        </div>
                    </div>
                    <!-- ./col -->
                    <div class="col-lg-6 col-xs-6">
                        <!-- small box -->
                        <div class="small-box bg-red">
                            <div class="inner">
                                <p>已用额度</p>
                                <h3>{{ item.usedmoney }}</h3>
                            </div>
                            <div class="icon">
                                <i class="ion ion-ios-locked"></i>
                            </div>
                            <a href="#" class="small-box-footer">
                                More info <i class="fa fa-arrow-circle-right"></i>
                            </a>
                        </div>
                    </div>
                    <!-- ./col -->
                </div>
                <form method='POST' action=''>{% csrf_token %}
                    <!-- left column -->
                    <div class="box box-danger">
                        <div class="box-body">
                            <div id="div_id_task_title" class="form-group">
                                <label for="id_task_title" class="control-label"><h3>保证金：</h3></label>
                            </div>
                            {{ form|crispy }}

                        </div>


                        <div class="box-footer">
                            <input class="btn btn-primary" value="提交" type="submit">
                            <a><input class="btn btn-default" value="取消" type="button"></a>
                        </div>
                        <!-- /.box-body -->
                    </div>


                </form>

            </div>
            <div class="col-md-7">
                <div id="main" style="width: 600px;height:400px;"></div>
                <script>
                    // 绘制图表。
                    echarts.init(document.getElementById('main')).setOption({
                        tooltip: {
                            trigger: 'item',
                            formatter: "{b}: {c} ({d}%)"
                        },
                        legend: {
                            orient: 'vertical',
                            x: 'left',
                            data: ['保证金', '入池票', '可用额度', '已用额度']
                        },
                        series: [
                            {
                                name: ' ',
                                type: 'pie',
                                selectedMode: 'single',
                                radius: [0, '30%'],

                                label: {
                                    normal: {
                                        position: 'inner'
                                    }
                                },
                                labelLine: {
                                    normal: {
                                        show: false
                                    }
                                },
                                data: [
                                    {value: {{ sum_money }}, name: '入池票'},
                                    {value: {{ item.promoney }}, name: '保证金'},
                                ]
                            },
                            {
                                name: ' ',
                                type: 'pie',
                                radius: ['40%', '55%'],
                                label: {
                                    normal: {
                                        formatter: '   {b|{b}：}{c}  {per|{d}%}  ',
                                        backgroundColor: '#afe',
                                        borderColor: '#aaa',
                                        borderWidth: 1,
                                        borderRadius: 4,
                                        rich: {
                                            b: {
                                                fontSize: 16,
                                                lineHeight: 33
                                            },
                                            per: {
                                                color: '#cee',
                                                backgroundColor: '#334455',
                                                padding: [2, 4],
                                                borderRadius: 2
                                            }
                                        }
                                    }
                                },
                                data: [
                                    {value: {{ item.unusemoney }}, name: '可用额度'},
                                    {value: {{ item.usedmoney }}, name: '已用额度'}
                                ]
                            }
                        ]
                    });
                </script>
                <div class="row">
                    <div>
                        <table id="table_id" class="table table-striped table-bordered table-hover">
                            <thead>
                            <!--表格头部-->
                            <th>费用内容</th>
                            <th>金额</th>
                            <th>添加日期</th>
                            <th>相关票据/<br/>银行卡</th>
                            </thead>
                            <!--表格内容-->
                            <tbody>
                            {% for i in data %}
                                <tr>
                                    <td>
                                        {% if i.pool_status == 1 %}
                                            <span class="label label-success">入池</span>
                                        {% elif i.pool_status == 2 %}
                                            <span class="label label-danger">出池</span>
                                        {% elif i.pool_status == 3 %}
                                            <span class="label label-info">保证金收入</span>
                                        {% elif i.pool_status == 4 %}
                                            <span class="label label-warning">保证金支出</span>
                                        {% elif i.pool_status == 5 %}
                                            <span class="label label-primary">开票付款</span>
                                        {% endif %}</td>
                                    <td>
                                        {% if i.money > 0 %}
                                            <span class="label label-success">
                                        {% else %}
                                            <span class="label label-danger">
                                        {% endif %}
                                        {{ i.money }}</span></td>
                                    <td>{{ i.pub_date }}</td>
                                    <td>
                                        {% if i.ticket %}
                                            <span class="label label-success">{{ i.ticket }}
                                        {% elif i.card %}
                                            <span class="label label-danger">{{ i.card }}
                                        {% endif %}
                                        </span></td>
                                </tr>

                            {% endfor %}

                            </tbody>
                        </table>
                    </div>
                    <!--引入modal.html-->
                    {% include 'ticket/modal.html' %}
                    <!--引入pagination.html-->
                    {% include 'ticket/pagination.html' %}
                </div>

            </div>


        </div>
    </section>

{% endblock %}

